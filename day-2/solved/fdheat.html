

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Finite differences for heat equation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/mystnb.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .secondtoggle, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script async="async" src="../../_static/thebelab.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../../welcome.html">Introduction to Geodynamic Modelling</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">General info</p>
</li>
  <li class="">
    <a href="../../course-info/general-info.html">General info</a>
  </li>
  <li class="">
    <a href="../../course-info/learning-goals.html">Learning goals</a>
  </li>
  <li class="">
    <a href="../../course-info/grading.html">Grading</a>
  </li>
  <li class="">
    <a href="../../course-info/resources.html">Resources</a>
  </li>
  <li class="">
    <a href="../../course-info/licensing.html">License and terms of usage</a>
  </li>
  <li class="">
    <a href="../../course-info/previous-years.html">Past versions of this course</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Day 1</p>
</li>
  <li class="">
    <a href="../../day-1/course-overview.html">Course overview</a>
  </li>
  <li class="">
    <a href="../../day-1/physical-processes.html">Processes and concepts</a>
  </li>
  <li class="">
    <a href="../../day-1/solving-equations.html">Solving equations</a>
  </li>
  <li class="">
    <a href="../../day-1/python-basics.html">Basic elements of Python</a>
  </li>
  <li class="">
    <a href="../../day-1/functions.html">Functions</a>
  </li>
  <li class="">
    <a href="../../day-1/numpy.html">Introduction to NumPy</a>
  </li>
  <li class="">
    <a href="../../day-1/for-loops.html">for loops</a>
  </li>
  <li class="">
    <a href="../../day-1/conditional-statements.html">Conditional statements</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Day 2</p>
</li>
  <li class="">
    <a href="../fdbasics.html">Introduction to finite differences</a>
  </li>
  <li class="">
    <a href="../fdheat.html">Finite differences for the heat equation</a>
  </li>
  <li class="">
    <a href="../stability.html">Stability of the heat equation FD approximation</a>
  </li>
  <li class="">
    <a href="../diffadv.html">Heat diffusion + advection</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Day 3</p>
</li>
  <li class="">
    <a href="../../day-3/benchmarking.html">Testing your code and benchmarking</a>
  </li>
  <li class="">
    <a href="../../day-3/stokes.html">FD for Stokes equation</a>
  </li>
  <li class="">
    <a href="../../day-3/channel.html">Solution strategy for the channel flow</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Day 4</p>
</li>
  <li class="">
    <a href="../../day-4/clusters.html">Cluster computing</a>
  </li>
  <li class="">
    <a href="../../day-4/putting-it-together.html">Putting it all together</a>
  </li>
  <li class="">
    <a href="../../day-4/marker-in-cell.html">Marker-in-cell technique</a>
  </li>
  <li class="">
    <a href="../../day-4/numerical-diffusion.html">Numerical diffusion</a>
  </li>
  <li class="">
    <a href="../../day-4/intro-to-douar.html">Introduction to DOUAR</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Day 5</p>
</li>
  <li class="">
    <a href="../../day-5/cli-tools.html">Helpful command line tools</a>
  </li>
  <li class="">
    <a href="../../day-5/project-overview.html">Project overview</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Technical instructions</p>
</li>
  <li class="">
    <a href="../../instructions/cluster.html">Using geo-hpcc cluster</a>
  </li>
</ul>
</nav>
<p class="navbar_footer">Powered by <a href="https://jupyterbook.org">Jupyter Book</a></p>
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="../../_sources/day-2/solved/fdheat.ipynb.txt"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.ipynb</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Edit this page -->
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
            <div class="dropdown-buttons">
                
                <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/day-2/solved/fdheat.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip" data-placement="left"><img class="binder-button-logo" src="../../_static/images/logo_binder.svg" alt="Interact on binder">Binder</button></a>
                
                
                <button type="button" class="btn btn-secondary topbarbtn thebelab-launch-button" onclick="initThebelab()" title="Launch Thebelab" data-toggle="tooltip" data-placement="left"><i class="fas fa-rocket"></i><span style="margin-left: .4em;">ThebeLab</span></button>
                
            </div>
        </div>
        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#do" class="nav-link">Do</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#boundary-conditions-initial-conditions" class="nav-link">Boundary conditions, initial conditions</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#fd-heat-equation-and-cooling-of-an-intrusion" class="nav-link">FD, heat equation, and cooling of an intrusion</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#id1" class="nav-link">Do</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="finite-differences-for-heat-equation">
<h1>Finite differences for heat equation<a class="headerlink" href="#finite-differences-for-heat-equation" title="Permalink to this headline">¶</a></h1>
<p>Simple 1D diffusion-only constant-conductivity heat equation is <span class="math notranslate nohighlight">\($\rho C_p \frac{\partial T}{\partial t} = k \frac{\partial^2 T}{\partial x^2}\)</span>$</p>
<p>The second-order spatial derivative of temperature can be approximated with finite differences:
<span class="math notranslate nohighlight">\($\frac{\partial^2 T}{\partial x^2}\Big\vert_{x=x_1}^{t=t_1} 
\approx \left(\frac{\partial T}{\partial x}\Big\vert_{x=x_1+0.5\Delta x}^{t=t_1} - \frac{\partial T}{\partial x}\Big\vert_{x=x_1-0.5\Delta x}^{t=t_1}\right) / \Delta x 
\approx \left(\frac{T_{x=x_1+\Delta x}^{t=t_1} - T_{x=x_1}^{t=t_1}}{\Delta x} - \frac{T_{x=x_1}^{t=t_1} - T_{x=x_1-\Delta x}^{t=t_1}}{\Delta x}\right) / \Delta x
= \frac{T_{x=x_1+\Delta x}^{t=t_1} - 2T_{x=x_1}^{t=t_1} + T_{x=x_1 - \Delta x}^{t=t_1}}{(\Delta x)^2}\)</span>$</p>
<p>Since <span class="math notranslate nohighlight">\(x_1 - \Delta x = x_0\)</span> and <span class="math notranslate nohighlight">\(x_1 + \Delta x = x_2\)</span>, we get
<span class="math notranslate nohighlight">\($\frac{\partial^2 T}{\partial x^2}\Big\vert_{x=x_1}^{t=t_1} \approx \frac{T_{x=x_2}^{t=t_1} - 2T_{x=x_1}^{t=t_1} + T_{x=x_0}^{t=t_1}}{(\Delta x)^2} = \frac{T_{2}^{1} - 2T_{1}^{1} + T_{0}^{1}}{(\Delta x)^2}\)</span>$ where the last formula uses the short hand notation for indices. Note that here the superscripts do not mean “to power” but are indices for time steps.</p>
<p>Using the same short hand notation, we can approximate the time derivative of the temperature:
<span class="math notranslate nohighlight">\($\frac{\partial T}{\partial t}\Big\vert_{x=x_1}^{t=t_1} \approx \frac{T_1^2-T_1^1}{\Delta t}\)</span>$</p>
<p>These approximations can be generalized:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial^2 T}{\partial x^2}\Big\vert_{x=x_i}^{t=t_q} \approx \frac{T_{i+1}^{q} - 2T_{i}^{q} + T_{i-1}^{q}}{(\Delta x)^2}\]</div>
<div class="math notranslate nohighlight">
\[\frac{\partial T}{\partial t}\Big\vert_{x=x_i}^{t=t_q} \approx \frac{T_i^{q+1}-T_i^q}{\Delta t}\]</div>
<p>And thus the full finite differences approximation of the heat equation can be written as</p>
<div class="math notranslate nohighlight">
\[ \rho C_p \frac{T_i^{q+1}-T_i^q}{\Delta t} = k \frac{T_{i+1}^{q} - 2T_{i}^{q} + T_{i-1}^{q}}{(\Delta x)^2}\]</div>
<p>This applies to <em>any</em> <span class="math notranslate nohighlight">\(q\)</span> and <span class="math notranslate nohighlight">\(i\)</span>. If we know <span class="math notranslate nohighlight">\(T\)</span> everywhere at time <span class="math notranslate nohighlight">\(t_q\)</span>, we can calculate <span class="math notranslate nohighlight">\(T\)</span> at time <span class="math notranslate nohighlight">\(t_{q+1} = t_q + \Delta t\)</span>.</p>
<div class="section" id="do">
<h2>Do<a class="headerlink" href="#do" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>How would the implicit (backward difference in time) approximation look like for the heat equation? Recall that in the implicit approximation we used the values from the next time step to approximate the derivative. What is the problem in calculating <span class="math notranslate nohighlight">\(T_i^q\)</span> using the implicit approximation?</p></li>
</ul>
</div>
<div class="section" id="boundary-conditions-initial-conditions">
<h2>Boundary conditions, initial conditions<a class="headerlink" href="#boundary-conditions-initial-conditions" title="Permalink to this headline">¶</a></h2>
<p>To start calculating the values of <span class="math notranslate nohighlight">\(T\)</span>, we need the <em>initial</em> values at some time <span class="math notranslate nohighlight">\(t_0\)</span>. This temperature field is the so called <em>initial condition</em> for our problem. It is a type of boundary condition that applies to a temporally variable field.</p>
<p>(Spatial) boundary conditions are needed because when applying finite differences to a differential equation (in space), we need the surrounding values, such as <span class="math notranslate nohighlight">\(T_{i+1}\)</span> and <span class="math notranslate nohighlight">\(T_{i-1}\)</span> in the case of heat equation, to calculate the next value of <span class="math notranslate nohighlight">\(T_{i}\)</span>. These values are not available if we are near the geometrical boundary of the problem.</p>
</div>
<div class="section" id="fd-heat-equation-and-cooling-of-an-intrusion">
<h2>FD, heat equation, and cooling of an intrusion<a class="headerlink" href="#fd-heat-equation-and-cooling-of-an-intrusion" title="Permalink to this headline">¶</a></h2>
<p>Next we will use finite differences to model the cooling of a (very large) magma intrusion within the crust. The crust is limited by the upper surface and the crust-mantle boundary at the bottom. It is 35 km thick and intruded by a horizontal, granitic magma intrusion (sill) that extends from 5 km to 10 km depth. Our task is to calculate the temperature distribution in the crust after 100 kyrs.</p>
<p>Our strategy for solving the problem in Python is following:</p>
<ol class="simple">
<li><p>Draw a picture!</p></li>
<li><p>Decide on model geometry and physical parameters</p>
<ul class="simple">
<li><p>one-dimensional</p></li>
<li><p>homogeneous physical parameters</p></li>
<li><p><span class="math notranslate nohighlight">\(\Rightarrow\)</span> we can use the equation above</p></li>
</ul>
</li>
<li><p>Set physical parameters (<span class="math notranslate nohighlight">\(\rho\)</span>, <span class="math notranslate nohighlight">\(C_p\)</span>, <span class="math notranslate nohighlight">\(k\)</span>)</p></li>
<li><p>Set geometrical parameters (<span class="math notranslate nohighlight">\(L\)</span>, <span class="math notranslate nohighlight">\(\Delta x\)</span> <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">nx</span></code>)</p></li>
<li><p>Set total run time and time step size (<span class="math notranslate nohighlight">\(t_{total}\)</span>, <span class="math notranslate nohighlight">\(\Delta t\)</span> <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <code class="docutils literal notranslate"><span class="pre">nt</span></code>)</p></li>
<li><p>Decide and set boundary condition values <span class="math notranslate nohighlight">\(T_0\)</span> and <span class="math notranslate nohighlight">\(T_{nx-1}\)</span></p></li>
<li><p>Create two arrays that hold the temperature, size <code class="docutils literal notranslate"><span class="pre">nx</span></code> elements</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Tnew</span></code> for <span class="math notranslate nohighlight">\(T^{q+1}\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tprev</span></code> for <span class="math notranslate nohighlight">\(T^{q}\)</span></p></li>
</ul>
</li>
<li><p>Create an array for grid point locations (<span class="math notranslate nohighlight">\(x\)</span> coordinates), size <code class="docutils literal notranslate"><span class="pre">nx</span></code></p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">Tprev</span></code> to hold the initial temperature field</p>
<ul class="simple">
<li><p>Linear geotherm throughout the crust, constant temperature within the sill</p></li>
</ul>
</li>
<li><p>Start the loop that iterates over all the time steps. Within the time step:</p>
<ul class="simple">
<li><p>Set the temperature at the boundaries, according to boundary conditions, at <code class="docutils literal notranslate"><span class="pre">Tnew[0]</span></code> and <code class="docutils literal notranslate"><span class="pre">Tnew[nx-1]</span></code></p></li>
<li><p>Calculate remaining (internal grid points) within <code class="docutils literal notranslate"><span class="pre">Tnew</span></code> based on values of <code class="docutils literal notranslate"><span class="pre">Tprev</span></code></p></li>
<li><p>Prepare for next time step: Copy all values of <code class="docutils literal notranslate"><span class="pre">Tnew</span></code> to <code class="docutils literal notranslate"><span class="pre">Tprev</span></code></p></li>
</ul>
</li>
</ol>
<div class="section" id="id1">
<h3>Do<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Use the following frame to start implementing the code. Once the code seems to work, experiment with it:</p>
<ul>
<li><p>How does changing values of <code class="docutils literal notranslate"><span class="pre">Cp</span></code> and <code class="docutils literal notranslate"><span class="pre">rho</span></code> affect the results?</p></li>
<li><p>Give <code class="docutils literal notranslate"><span class="pre">dt</span></code> values that are close to the critical time step. How do the results change?</p></li>
<li><p>Can the code handle intrusions that are only 500 m in width?</p></li>
</ul>
</li>
<li><p>What have silently assumed in the implementation of the code? E.g. can we model the problem in simplified 1D world? What kind of physical processes, that are likely to be present, have we omitted?</p></li>
</ul>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Frame for FD solution for heat diffusion</span>
<span class="c1"># Fill in lines marked with &quot;(...)&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Set material properties</span>
<span class="n">rho</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>   <span class="c1"># rock density, kg m^-3</span>
<span class="n">Cp</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>    <span class="c1"># rock heat capacity, J kg^-1 K^-1</span>
<span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>     <span class="c1"># rock heat conductivity, W m^-1 K^-1</span>

<span class="c1"># Set geometry and dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>        <span class="c1"># thickness of the crust, m</span>
<span class="n">nx</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>       <span class="c1"># number of grid points, -</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dx is&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>

<span class="n">silltop</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>   <span class="c1"># depth of the top of the sill, m</span>
<span class="n">sillbott</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>  <span class="c1"># depth of the bottom of the sill, m</span>

<span class="c1"># Set total time and time step</span>
<span class="n">t_total</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>           <span class="c1"># total run time, s</span>
<span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>                <span class="c1"># time step, s</span>
<span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">t_total</span> <span class="o">/</span> <span class="n">dt</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating&quot;</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="s2">&quot;time steps&quot;</span><span class="p">)</span>

<span class="c1"># Set boundary temperature values and intrusion temperature</span>
<span class="n">Tsurf</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>      <span class="c1"># surface temperature, deg C</span>
<span class="n">Tmoho</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>      <span class="c1"># Moho temperature, deg C</span>
<span class="n">Tintrusion</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1"># Intrusion temperature, deg C</span>

<span class="c1"># TODO: Create arrays to hold temperature fields.</span>
<span class="c1"># These need to have `nx` elements and can be </span>
<span class="c1"># set to zero for now.</span>
<span class="n">Tnew</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">Tprev</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># TODO: Create coordinates of the grid points.</span>
<span class="c1"># We want `x` to have evenly spaced values </span>
<span class="c1"># from zero to `L`, with `nx` elements.</span>
<span class="c1"># Use `np.linspace()`.</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Generate initial temperature field.</span>
<span class="c1"># </span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
    <span class="c1"># TODO: Add condition that tests whether </span>
    <span class="c1"># element `ix` of `x` is inside the sill.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tintrusion</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># x[ix] is outside the sill.</span>
        <span class="c1"># This assumes linear geotherm between</span>
        <span class="c1"># surface temperature and moho temperature</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tmoho</span> <span class="o">-</span> <span class="n">Tsurf</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>

<span class="c1"># Plot initial temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tprev</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T initial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Start the loop over time steps</span>
<span class="n">curtime</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">curtime</span> <span class="o">&lt;</span> <span class="n">t_total</span><span class="p">:</span>
    <span class="n">curtime</span> <span class="o">=</span> <span class="n">curtime</span> <span class="o">+</span> <span class="n">dt</span>
    
    <span class="c1"># TODO: Set boundary conditions.</span>
    <span class="c1"># Set elements zero and `nx-1` of the new temperature field</span>
    <span class="c1"># to surface temperature and Moho temperature, respectively</span>
    <span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="p">(</span><span class="o">...</span><span class="p">)</span>
    
    <span class="c1"># Calculate next values of the internal grid points</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># TODO: Calculate the new temperature at Tnew[ix] based</span>
        <span class="c1"># on values in `Tprev`, `k`, `dt`, `rho` and `Cp`.</span>
        <span class="c1"># Use FD approximation from above and rearrange it</span>
        <span class="c1"># to get an expression for T_i^{q+1}. Be extra careful</span>
        <span class="c1"># with correct placement of parentheses!</span>
        <span class="n">Tnew</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>
        
    <span class="c1"># Copy values from Tnew to Tprev</span>
    <span class="n">Tprev</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">Tnew</span><span class="p">[:]</span>
    

<span class="c1"># Plot the final temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tnew</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T final&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">a3083fe0b59d</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>        <span class="c1"># thickness of the crust, m</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="n">nx</span> <span class="o">=</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>       <span class="c1"># number of grid points, -</span>
<span class="ne">---&gt; </span><span class="mi">15</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dx is&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> 

<span class="ne">TypeError</span>: unsupported operand type(s) for -: &#39;ellipsis&#39; and &#39;int&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### ANSWER ###</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">yr2sec</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mf">365.25</span>  <span class="c1"># num of seconds in a year</span>

<span class="c1"># Set material properties</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">2900</span>   <span class="c1"># kg m^-3</span>
<span class="n">Cp</span> <span class="o">=</span> <span class="mi">900</span>     <span class="c1"># J kg^-1 K^-1</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">2.5</span>      <span class="c1"># W m^-1 K^-1</span>

<span class="c1"># Set geometry and dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">35e3</span>         <span class="c1"># m</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">30</span>          <span class="c1"># -</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># m</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dx is&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>

<span class="n">silltop</span> <span class="o">=</span> <span class="mf">5e3</span>    <span class="c1"># m</span>
<span class="n">sillbott</span> <span class="o">=</span> <span class="mf">10e3</span>  <span class="c1"># m</span>

<span class="c1"># Set total time and time step</span>
<span class="n">t_total</span> <span class="o">=</span> <span class="mf">0.1e6</span> <span class="o">*</span> <span class="n">yr2sec</span>          <span class="c1"># s</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e4</span> <span class="o">*</span> <span class="n">yr2sec</span>                 <span class="c1"># s</span>
<span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">t_total</span> <span class="o">/</span> <span class="n">dt</span><span class="p">))</span>  <span class="c1"># -</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating&quot;</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="s2">&quot;time steps&quot;</span><span class="p">)</span>

<span class="c1"># Set boundary temperature values and intrusion temperature</span>
<span class="n">Tsurf</span> <span class="o">=</span> <span class="mf">0.0</span>        <span class="c1"># deg C</span>
<span class="n">Tmoho</span> <span class="o">=</span> <span class="mf">600.0</span>      <span class="c1"># deg C</span>
<span class="n">Tintrusion</span> <span class="o">=</span> <span class="mf">700.0</span> <span class="c1"># deg C</span>

<span class="c1"># Create arrays to hold temperature fields</span>
<span class="n">Tnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
<span class="n">Tprev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>

<span class="c1"># Create coordinates of the grid points</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

<span class="c1"># Generate initial temperature field</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sillbott</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">silltop</span><span class="p">):</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tintrusion</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tmoho</span> <span class="o">-</span> <span class="n">Tsurf</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>

<span class="c1"># Plot initial temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tprev</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T initial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Start the loop over time steps</span>
<span class="n">curtime</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">curtime</span> <span class="o">&lt;</span> <span class="n">t_total</span><span class="p">:</span>
    <span class="n">curtime</span> <span class="o">=</span> <span class="n">curtime</span> <span class="o">+</span> <span class="n">dt</span>
    
    <span class="c1"># boundary conditions</span>
    <span class="n">Tnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tsurf</span>
    <span class="n">Tnew</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tmoho</span>
    
    <span class="c1"># internal grid points</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Tnew</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">Cp</span><span class="p">)</span> <span class="o">+</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        
    <span class="c1"># copy Tnew to Tprev</span>
    <span class="n">Tprev</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">Tnew</span><span class="p">[:]</span>
    

<span class="c1"># Plot the final temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tnew</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T final&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>dx is 1206.896551724138 m
Calculating 10 time steps
</pre></div>
</div>
<img alt="../../_images/fdheat_15_1.png" src="../../_images/fdheat_15_1.png" />
<img alt="../../_images/fdheat_15_2.png" src="../../_images/fdheat_15_2.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "executablebooks/jupyter-book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "day-2/solved"
        }
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By David Whipp and Lars Kaislaniemi<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>