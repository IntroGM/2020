

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Testing your code and benchmarking</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .secondtoggle, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script async="async" src="../_static/thebelab.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="canonical" href="https://introgm.github.io/2020/day-3/benchmarking.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">


<!-- Opengraph tags -->
<meta property="og:url"         content="https://introgm.github.io/2020/day-3/benchmarking.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Testing your code and benchmarking" />
<meta property="og:description" content="Testing your code and benchmarking  As we have seen yesterday, it is possible to use the finite difference method to solve equations, and if we use a sufficient" />
<meta property="og:image"       content="https://introgm.github.io/2020/_static/introgm-logo.png" />

<meta name="twitter:card" content="summary">


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/introgm-logo.png" class="logo" alt="logo">
  
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
<li class="navbar-special">
<p class="margin-caption">General info</p>
</li>
  <li class="">
    <a href="../course-info/general-info.html">General info</a>
  </li>
  <li class="">
    <a href="../course-info/learning-goals.html">Learning goals</a>
  </li>
  <li class="">
    <a href="../course-info/grading.html">Grading</a>
  </li>
  <li class="">
    <a href="../course-info/resources.html">Resources</a>
  </li>
  <li class="">
    <a href="../course-info/licensing.html">License and terms of usage</a>
  </li>
  <li class="">
    <a href="../course-info/previous-years.html">Past versions of this course</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Day 1</p>
</li>
  <li class="">
    <a href="../day-1/course-overview.html">Course overview</a>
  </li>
  <li class="">
    <a href="../day-1/physical-processes.html">Processes and concepts</a>
  </li>
  <li class="">
    <a href="../day-1/solving-equations.html">Solving equations</a>
  </li>
  <li class="">
    <a href="../day-1/python-basics.html">Basic elements of Python</a>
  </li>
  <li class="">
    <a href="../day-1/functions.html">Functions</a>
  </li>
  <li class="">
    <a href="../day-1/numpy.html">Introduction to NumPy</a>
  </li>
  <li class="">
    <a href="../day-1/for-loops.html">for loops</a>
  </li>
  <li class="">
    <a href="../day-1/conditional-statements.html">Conditional statements</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="../_sources/day-3/benchmarking.ipynb.txt"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.ipynb</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Edit this page -->
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
            <div class="dropdown-buttons">
                
                <a class="binder-button" href="https://mybinder.org/v2/gh/IntroGM/2020/master?urlpath=lab/tree/day-3/benchmarking.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip" data-placement="left"><img class="binder-button-logo" src="../_static/images/logo_binder.svg" alt="Interact on binder">Binder</button></a>
                
                
                <button type="button" class="btn btn-secondary topbarbtn thebelab-launch-button" onclick="initThebelab()" title="Launch Thebelab" data-toggle="tooltip" data-placement="left"><i class="fas fa-rocket"></i><span style="margin-left: .4em;">ThebeLab</span></button>
                
            </div>
        </div>
        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#sources-of-error-revisited" class="nav-link">Sources of error (revisited)</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#calculating-error" class="nav-link">Calculating error</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#how-do-you-know-when-your-solution-is-correct" class="nav-link">How do you know when your solution is “correct”?</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#exercise-spatial-errors-in-heat-conduction" class="nav-link">Exercise - Spatial errors in heat conduction</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#tasks" class="nav-link">Tasks</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#questions" class="nav-link">Questions</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#notes" class="nav-link">Notes</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#exercise-visualizing-error-optional" class="nav-link">Exercise - Visualizing error (optional)</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#id1" class="nav-link">Tasks</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#id2" class="nav-link">Questions</a>
        </li>
    
            </ul>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#stability-for-advection-problems" class="nav-link">Stability for advection problems</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#exercise-the-time-bomb" class="nav-link">Exercise - The time bomb</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#id3" class="nav-link">Questions</a>
        </li>
    
            </ul>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="testing-your-code-and-benchmarking">
<h1>Testing your code and benchmarking<a class="headerlink" href="#testing-your-code-and-benchmarking" title="Permalink to this headline">¶</a></h1>
<p>As we have seen <code class="xref any docutils literal notranslate"><span class="pre">yesterday</span></code>, it is possible to use the finite difference method to solve equations, and if we use a sufficiently high resolution we can get a very precise solution. But is it correct? It can be difficult to know without directly comparing our solutions to known correct values. This process will be the focus of this lesson.</p>
<div class="section" id="sources-of-error-revisited">
<h2>Sources of error (revisited)<a class="headerlink" href="#sources-of-error-revisited" title="Permalink to this headline">¶</a></h2>
<p>We have focussed thus far on using the finite difference method to approximate solutions to equations that we cannot directly integrate. As we have seen, the definition of a derivative is</p>
<div class="math notranslate nohighlight">
\[\frac{\mathrm{d}f}{\mathrm{d}x}\rvert_{x=x_0} = \lim_{\Delta x \rightarrow 0} \frac{f(x_0 + \Delta x) - f(x_0)}{\Delta x},\]</div>
<p>which we can approximate in a number of forms by removing the limit <span class="math notranslate nohighlight">\(\Delta x \rightarrow 0\)</span>. For example, we have seen that for forward differences we can state</p>
<div class="math notranslate nohighlight">
\[\frac{\mathrm{d}f}{\mathrm{d}x}\rvert_{x=x_0} \approx \frac{f(x_0 + \Delta x) - f(x_0)}{\Delta x}.\]</div>
<p>And again, as long as <span class="math notranslate nohighlight">\(\Delta x\)</span> is “small enough”, the error that is introduced in this approximation is fairly small. So the question is, how do we know when <span class="math notranslate nohighlight">\(\Delta x\)</span> is small enough to not introduce significant error? Before we can answer that question, we need to say a few things about the sources of error in any computer-based calculation and how we can calculate these errors.</p>
<p>In computations there are essentially three different sources of error we can consider:</p>
<ul class="simple">
<li><p><strong>Gross error</strong>: A mistake in the program itself, a bug.</p></li>
<li><p><strong>Truncation error</strong>: Error introduced by approximating the solution to a problem, such as using a finite-difference solution rather than direct integration of an equation. You might recall this is the error we introduce by <a class="reference external" href="../day-2/fdbasics.ipynb#Taylor-series-approach%3B-accuracy">truncating the Taylor series expansion</a> of a function <span class="math notranslate nohighlight">\(f(x)\)</span>.</p></li>
<li><p><strong>Roundoff error</strong>: Error related to the computers inability to exactly represent floating point numbers. We have seen some examples of roundoff error as well at the <a class="reference external" href="../day-2/fdbasics.ipynb#Introduction-to-finite-differences">start of the introduction to finite differences</a>.</p></li>
</ul>
<p>Although all three of these sources of error can appear in our programs, we mainly will focus on issues related to truncation error in our discussion in the following sections.</p>
</div>
<div class="section" id="calculating-error">
<h2>Calculating error<a class="headerlink" href="#calculating-error" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a sense of the different types of error we might encounter, we can turn our focus to how error can be calculated. Simply put, the <strong>error</strong> in a calculation is simply the difference between the calculated value and the actual value. In other words,</p>
<div class="math notranslate nohighlight">
\[E = \bar{x} - x\]</div>
<p>where <span class="math notranslate nohighlight">\(E\)</span> is the error in the calculated value <span class="math notranslate nohighlight">\(x\)</span> compared to its true value <span class="math notranslate nohighlight">\(\bar{x}\)</span>. Another common way in which error is represented is as <strong>relative error</strong> (<span class="math notranslate nohighlight">\(RE\)</span>), which is simply the error divided by the true value,</p>
<div class="math notranslate nohighlight">
\[RE = \frac{E}{\bar{x}}\]</div>
<p>For our purposes we will mainly consider the <strong>percent error</strong> (<span class="math notranslate nohighlight">\(PE\)</span>), which is just the relative error multiplied by 100</p>
<div class="math notranslate nohighlight">
\[PE = 100 RE.\]</div>
</div>
<div class="section" id="how-do-you-know-when-your-solution-is-correct">
<h2>How do you know when your solution is “correct”?<a class="headerlink" href="#how-do-you-know-when-your-solution-is-correct" title="Permalink to this headline">¶</a></h2>
<p>In order to determine whether or not we need to be concerned with errors in our estimates, we need to compare our estimate to the true values as seen above. This process is often referred to as <strong>benchmarking</strong> or <strong>stability testing</strong>. How do we do this in practice? We recommend the following procedure:</p>
<ol class="simple">
<li><p>Start with using an approximate solution for which a true value can be calculated. It is obviously not possible to make a comparison if you don’t know the true values.</p></li>
<li><p>Assuming you have an equation the will allow you to calculate true values at any location within the domain of your problem, begin by calculating the estimated values and true values at the same spatial (and/or temporal) locations.</p></li>
<li><p>For each estimate and corresponding true value, calculate the percent error and store its value.</p></li>
<li><p>Review the output in a form that makes sense to you. Possibilities include</p>
<ul class="simple">
<li><p>Calculating the mean percent error, or its maximum</p></li>
<li><p>Plotting the percent error along with the estimated values</p></li>
<li><p>Summing the percent error</p></li>
</ul>
</li>
</ol>
<div class="section" id="exercise-spatial-errors-in-heat-conduction">
<h3>Exercise - Spatial errors in heat conduction<a class="headerlink" href="#exercise-spatial-errors-in-heat-conduction" title="Permalink to this headline">¶</a></h3>
<p>Now that you hopefully have a working solution to the heat advection-diffusion equation in one dimension we can assess the magnitude of error we introduce when poorly discretizing the problem in space. In other words, how bad do things get when we only estimate temperatures at distant points? For this exercise, you can use either your existing solution to the 1D heat advection-diffusion equation or the code in the cell below.</p>
<div class="section" id="tasks">
<h4>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>Add the calculation of two analytical solutions for heat conduction to the bottom of the code. These will be used for comparison with the finite difference calculations. The analytical solutions to add are <strong>(1) steady-state advection with no heat production</strong></p>
<div class="math notranslate nohighlight">
\[T(x) = T_{L} \left( \frac{1 - \exp{(v_{x} x / \kappa)}}{1 - \exp{(v_{x} L / \kappa)}} \right)\]</div>
<p>where <span class="math notranslate nohighlight">\(T_{L}\)</span> is the temperature at the bottom of the model, <span class="math notranslate nohighlight">\(v_{x}\)</span> is the advection velocity, <span class="math notranslate nohighlight">\(L\)</span> is the model thickness, and <span class="math notranslate nohighlight">\(\kappa\)</span> is the thermal diffusivity (<span class="math notranslate nohighlight">\(\kappa = k / \rho C_{\mathrm{p}}\)</span>), and <strong>(2) steady-state heat conduction with heat production, but no advection</strong></p>
<div class="math notranslate nohighlight">
\[T(x) = \frac{x T_{L}}{L} + \frac{h^{2}_{\mathrm{r}} H}{k} \left( \left( 1 - \exp{(-x / h_{\mathrm{r}})}\right) - \left( 1 - \exp{(-L / h_{\mathrm{r}})}\right) \frac{x}{L} \right)\]</div>
<p>where <span class="math notranslate nohighlight">\(h_{\mathrm{r}}\)</span> is the depth at which the concentration of heat producing elements decreases by <span class="math notranslate nohighlight">\(1/e\)</span>. Since we do not include this behavior in our model, we will assume that <span class="math notranslate nohighlight">\(h_{\mathrm{r}} = 10000\)</span> km.</p>
</li>
<li><p>Implement the calculation of the analytical solutions (true values) at the end of the code just above the plotting so that the true values are calculated at the same spatial locations <span class="math notranslate nohighlight">\(x\)</span> as the finite difference calculations. You can set things up so that you calculate <code class="docutils literal notranslate"><span class="pre">Tss_adv</span></code> for the advection case and <code class="docutils literal notranslate"><span class="pre">Tss_hp</span></code> for the heat production case.</p></li>
<li><p>Add the necessary code to be able to plot either one of the analytical solutions with the finite difference solution.</p></li>
<li><p>Since we are comparing against steady-state solutions, we need to be sure that our model has reached a thermal steady state. We can estimate the time needed to reach steady state using the characteristic timescale for diffusion <span class="math notranslate nohighlight">\(\tau\)</span></p>
<div class="math notranslate nohighlight">
\[\tau = \frac{L^{2}}{\kappa}.\]</div>
<p>calculate the characteristic timescale for your models using the values in the code and be sure to set <code class="docutils literal notranslate"><span class="pre">t_total</span></code> to be larger than that timescale (perhaps even twice as large to be safe).</p>
</li>
<li><p>Starting with <code class="docutils literal notranslate"><span class="pre">nx</span> <span class="pre">=</span> <span class="pre">6</span></code>), calculate the percent error in the calculated temperature for each location of <span class="math notranslate nohighlight">\(x\)</span> for the following scenarios:</p>
<ul class="simple">
<li><p>Steady advection-diffusion with no heat production (<code class="docutils literal notranslate"><span class="pre">vx</span> <span class="pre">=</span> <span class="pre">1.0</span></code>, <code class="docutils literal notranslate"><span class="pre">H</span> <span class="pre">=</span> <span class="pre">0.0</span></code>)</p></li>
<li><p>Steady heat diffusion and production with no advection (<code class="docutils literal notranslate"><span class="pre">vx</span> <span class="pre">=</span> <span class="pre">0.0</span></code>, <code class="docutils literal notranslate"><span class="pre">H</span> <span class="pre">=</span> <span class="pre">1.0</span></code>)</p></li>
</ul>
<p>Remember to change which analytical solution is used when you compare to the model output.</p>
</li>
<li><p>Add two lines to the code near the end to print out the minimum and maximum percent error to the screen using the <code class="docutils literal notranslate"><span class="pre">print()</span></code> function.</p></li>
</ol>
</div>
<div class="section" id="questions">
<h4>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>If you vary the values for <code class="docutils literal notranslate"><span class="pre">nx</span></code>, approximately how many points are required for the percent error to be less than 0.05%?</p></li>
<li><p>Does the percent error continue to decrease as you increase <code class="docutils literal notranslate"><span class="pre">nx</span></code>, or does it a appear to reach a minimum at some point?</p></li>
</ul>
</div>
<div class="section" id="notes">
<h4>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Although it is possible to perform step 5 directly in NumPy and without a for loop, you are advised to use a for loop for calculating the percent error.</p></li>
<li><p>You may want to skip over calculating the percent error for the first temperature point since the true value at the surface is equal to zero, and calculating percent error at the location will result in division by zero.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">yr2sec</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mf">365.25</span>  <span class="c1"># num of seconds in a year</span>

<span class="c1"># Set material properties</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">2900</span>   <span class="c1"># kg m^-3</span>
<span class="n">Cp</span> <span class="o">=</span> <span class="mi">900</span>     <span class="c1"># J kg^-1 K^-1</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">2.5</span>      <span class="c1"># W m^-1 K^-1</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">1.0</span>      <span class="c1"># uW m^-3</span>
<span class="n">vx</span> <span class="o">=</span> <span class="mf">0.0</span>     <span class="c1"># mm/a</span>
<span class="n">hr</span> <span class="o">=</span> <span class="mi">10000</span>   <span class="c1"># km</span>

<span class="c1"># Set geometry and dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">35e3</span>         <span class="c1"># m</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">6</span>           <span class="c1"># -</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># m</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dx is&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>

<span class="c1"># NOTE: I have set the sill top and bottom equal to not have an intrusion</span>
<span class="n">silltop</span> <span class="o">=</span> <span class="mf">10e3</span>   <span class="c1"># m</span>
<span class="n">sillbott</span> <span class="o">=</span> <span class="mf">10e3</span>  <span class="c1"># m</span>

<span class="c1"># Convert units</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">H</span> <span class="o">*</span> <span class="mf">1.0e-6</span>                    <span class="c1"># uW m^-3 -&gt; W m^-3</span>
<span class="n">vx</span> <span class="o">=</span> <span class="o">-</span><span class="n">vx</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">yr2sec</span>        <span class="c1"># mm a^-1 -&gt; m s^-1</span>
<span class="n">hr</span> <span class="o">=</span> <span class="n">hr</span> <span class="o">*</span> <span class="mi">1000</span>                    <span class="c1"># km -&gt; m</span>

<span class="c1"># Set total time and time step</span>
<span class="n">t_total</span> <span class="o">=</span> <span class="mf">0.1e6</span> <span class="o">*</span> <span class="n">yr2sec</span>          <span class="c1"># s</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e4</span> <span class="o">*</span> <span class="n">yr2sec</span>                 <span class="c1"># s</span>
<span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">t_total</span> <span class="o">/</span> <span class="n">dt</span><span class="p">))</span>  <span class="c1"># -</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating&quot;</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="s2">&quot;time steps&quot;</span><span class="p">)</span>

<span class="c1"># Set boundary temperature values and intrusion temperature</span>
<span class="n">Tsurf</span> <span class="o">=</span> <span class="mf">0.0</span>        <span class="c1"># deg C</span>
<span class="n">Tmoho</span> <span class="o">=</span> <span class="mf">600.0</span>      <span class="c1"># deg C</span>
<span class="n">Tintrusion</span> <span class="o">=</span> <span class="mf">700.0</span> <span class="c1"># deg C</span>

<span class="c1"># Create arrays to hold temperature fields</span>
<span class="n">Tnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
<span class="n">Tprev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>

<span class="c1"># Create coordinates of the grid points</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

<span class="c1"># Generate initial temperature field</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sillbott</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">silltop</span><span class="p">):</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tintrusion</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tmoho</span> <span class="o">-</span> <span class="n">Tsurf</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>

<span class="c1"># Plot initial temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tprev</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T initial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Start the loop over time steps</span>
<span class="n">curtime</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">curtime</span> <span class="o">&lt;</span> <span class="n">t_total</span><span class="p">:</span>
    <span class="n">curtime</span> <span class="o">=</span> <span class="n">curtime</span> <span class="o">+</span> <span class="n">dt</span>
    
    <span class="c1"># boundary conditions</span>
    <span class="n">Tnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tsurf</span>
    <span class="n">Tnew</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tmoho</span>
    
    <span class="c1"># internal grid points</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Tnew</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">Cp</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">vx</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">H</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">Cp</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        
    <span class="c1"># copy Tnew to Tprev</span>
    <span class="n">Tprev</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">Tnew</span><span class="p">[:]</span>

<span class="c1"># Calculate analytical solution(s)</span>
<span class="c1"># 1. Steady-state advection, no heat production</span>
<span class="c1">#Tss_adv = </span>

<span class="c1"># 2. Steady-state conduction with heat production, no advection</span>
<span class="c1">#Tss_hp = </span>

<span class="c1"># Plot the final temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tnew</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T final&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>dx is 7000.0 m
Calculating 10 time steps
</pre></div>
</div>
<img alt="../_images/benchmarking_5_1.png" src="../_images/benchmarking_5_1.png" />
<img alt="../_images/benchmarking_5_2.png" src="../_images/benchmarking_5_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="exercise-visualizing-error-optional">
<h3>Exercise - Visualizing error (optional)<a class="headerlink" href="#exercise-visualizing-error-optional" title="Permalink to this headline">¶</a></h3>
<p>In the previous exercise we observed error by outputting the minimum and maximum to the screen using the <code class="docutils literal notranslate"><span class="pre">print()</span></code> function. However, it is often nice to not only see the range of error, but also how it varies in your calculation. In other words, it is nice to see where the error is largest, not just how large it may be. In this exercise we will add a plot to those displayed in the heat conduction script to see both the temperatures and percent error side by side.</p>
<div class="section" id="id1">
<h4>Tasks<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ol>
<li><p>Taking your code from the previous exercise, you will need to make some changes to the plotting at the end of the script to be able to display two plots side by side. You can start by making the changes below in your code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tnew</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_ss_adv</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (C)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Depth (km)&quot;</span><span class="p">)</span>
<span class="c1"># Plot percent error below</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The main changes above are (1) changing the <code class="docutils literal notranslate"><span class="pre">plt.subplots()</span></code> function to produce 1 row of plots with 2 columns of plots, and referring to those as <code class="docutils literal notranslate"><span class="pre">ax1</span></code> and <code class="docutils literal notranslate"><span class="pre">ax2</span></code>, (2) replacing the <code class="docutils literal notranslate"><span class="pre">plt.xlabel()</span></code> and <code class="docutils literal notranslate"><span class="pre">plt.ylabel()</span></code> with their equivalent commands for each plot, and (3) adding the second plot as <code class="docutils literal notranslate"><span class="pre">ax2</span></code>.</p>
</li>
<li><p>With the changes above, insert the variables you want to plot on the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> axes of the second plot in the <code class="docutils literal notranslate"><span class="pre">ax2.plot()</span></code> function, using the plot format <code class="docutils literal notranslate"><span class="pre">'-*'</span></code>.</p></li>
<li><p>Add a label for the <span class="math notranslate nohighlight">\(x\)</span> axis for the second plot.</p></li>
</ol>
</div>
<div class="section" id="id2">
<h4>Questions<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>If you perform a similar analysis to that done in the previous exercise (changing <code class="docutils literal notranslate"><span class="pre">nx</span></code> and viewing the resulting error), does this seem more helpful than simply looking at the minimum and maximum error values?</p></li>
<li><p>Do you see any changes in terms of where the error occurs, or its magnitude at different depths when you change <code class="docutils literal notranslate"><span class="pre">nx</span></code>?</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="stability-for-advection-problems">
<h2>Stability for advection problems<a class="headerlink" href="#stability-for-advection-problems" title="Permalink to this headline">¶</a></h2>
<p>We have observed that changing the spatial resolution (distance between calculation points) can affect the error in our finite difference solutions. Specifically, larger distances between points tends to increase error. We have also been <code class="xref any docutils literal notranslate"><span class="pre">introduced</span></code> to problems with the <strong>stability</strong> of our solutions. As a reminder, the stability of a solution refers to whether or not a small change in the parameters of the system results in unstable growth of errors. For problems involving time, a stable solution should either show a decrease in error with time or errors that do not change with time. An unstable solution will show growth of errors with time that do not become bounded, and often grow larger over time.</p>
<p>Yesterday we dealt mainly with diffusion of thermal energy and encountered a <em>stability condition for diffusion problems</em></p>
<div class="math notranslate nohighlight">
\[\frac{\kappa \Delta t}{\Delta x^2} \leq \frac{1}{2}\]</div>
<p>where <span class="math notranslate nohighlight">\(\kappa\)</span> is the thermal diffusivity, <span class="math notranslate nohighlight">\(\Delta t\)</span> is the time step, and <span class="math notranslate nohighlight">\(\Delta x\)</span> is the grid spacing.
This condition ensures that the length scale for diffusion does not exceed the length scale of the grid spacing and that error does not grow with time. As mentioned, it is often the case that a more strict stability condition is used such as <span class="math notranslate nohighlight">\(\frac{\kappa \Delta t}{\Delta x^2} \leq \frac{1}{4}\)</span>.</p>
<p>Like diffusion problems, advection problems also have various criteria that can be used to ensure stability of the solution and the range of parameters that result in stable behavior. For example, it is common to use the calculation of the Courant-Friedrichs-Lewy (or CFL) condition in problems that involve advection. The CFL condition states that the distance material is advected should not exceed the distance between points in the solution grid. In mathematical terms, the CFL condition is</p>
<div class="math notranslate nohighlight">
\[C = \frac{u \Delta t}{\Delta x} \leq C_{\mathrm{max}}\]</div>
<p>where <span class="math notranslate nohighlight">\(u\)</span> is the velocity of advection. We expect a stable solution as long as <span class="math notranslate nohighlight">\(C_{\mathrm{max}} \leq 1.0\)</span>. In fact, like the case for diffusion many people use a smaller value to ensure stability with a typical value of <span class="math notranslate nohighlight">\(C_{\mathrm{max}} \leq 0.5\)</span> to ensure a stable solution.</p>
<div class="section" id="exercise-the-time-bomb">
<h3>Exercise - The time bomb<a class="headerlink" href="#exercise-the-time-bomb" title="Permalink to this headline">¶</a></h3>
<p>We’ll now take a look and an example of how a solution might become unstable. We will again use our advection-diffusion solution, this time exploring the effect of changes in time step. A copy of the code from the last exercise is below, minus the plotting of the analytical solutions.</p>
<div class="section" id="id3">
<h4>Questions<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Using a spatial grid resolution of <code class="docutils literal notranslate"><span class="pre">nx</span> <span class="pre">=</span> <span class="pre">30</span></code>, what do you observe as you increase the time step increment <code class="docutils literal notranslate"><span class="pre">dt</span></code> from <span class="math notranslate nohighlight">\(10^{4}\)</span> years? Try increasing in steps of <span class="math notranslate nohighlight">\(1 \times 10^{4}\)</span> until you notice a change in the calculated temperatures.</p></li>
<li><p>Do you observe any surprising changes in the error?</p></li>
<li><p>Why do you think this might occur?</p></li>
<li><p>Can you relate this to our stability criteria?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">yr2sec</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mf">365.25</span>  <span class="c1"># num of seconds in a year</span>

<span class="c1"># Set material properties</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">2900</span>   <span class="c1"># kg m^-3</span>
<span class="n">Cp</span> <span class="o">=</span> <span class="mi">900</span>     <span class="c1"># J kg^-1 K^-1</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">2.5</span>      <span class="c1"># W m^-1 K^-1</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">0.0</span>      <span class="c1"># uW m^-3</span>
<span class="n">vx</span> <span class="o">=</span> <span class="mf">1.0</span>     <span class="c1"># mm/a</span>

<span class="c1"># Set geometry and dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">35e3</span>         <span class="c1"># m</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">30</span>         <span class="c1"># -</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># m</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dx is&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>

<span class="c1"># NOTE: I have set the sill top and bottom equal to not have an intrusion</span>
<span class="n">silltop</span> <span class="o">=</span> <span class="mf">10e3</span>   <span class="c1"># m</span>
<span class="n">sillbott</span> <span class="o">=</span> <span class="mf">10e3</span>  <span class="c1"># m</span>

<span class="c1"># Convert units</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">H</span> <span class="o">*</span> <span class="mf">1.0e-6</span>                    <span class="c1"># uW m^-3 -&gt; W m^-3</span>
<span class="n">vx</span> <span class="o">=</span> <span class="o">-</span><span class="n">vx</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">yr2sec</span>        <span class="c1"># mm a^-1 -&gt; m s^-1</span>

<span class="c1"># Set total time and time step</span>
<span class="n">t_total</span> <span class="o">=</span> <span class="mf">10.0e6</span> <span class="o">*</span> <span class="n">yr2sec</span>          <span class="c1"># s</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e4</span> <span class="o">*</span> <span class="n">yr2sec</span>                 <span class="c1"># s</span>
<span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">t_total</span> <span class="o">/</span> <span class="n">dt</span><span class="p">))</span>  <span class="c1"># -</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating&quot;</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="s2">&quot;time steps&quot;</span><span class="p">)</span>

<span class="c1"># Set boundary temperature values and intrusion temperature</span>
<span class="n">Tsurf</span> <span class="o">=</span> <span class="mf">0.0</span>        <span class="c1"># deg C</span>
<span class="n">Tmoho</span> <span class="o">=</span> <span class="mf">600.0</span>      <span class="c1"># deg C</span>
<span class="n">Tintrusion</span> <span class="o">=</span> <span class="mf">700.0</span> <span class="c1"># deg C</span>

<span class="c1"># Create arrays to hold temperature fields</span>
<span class="n">Tnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
<span class="n">Tprev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>

<span class="c1"># Create coordinates of the grid points</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

<span class="c1"># Generate initial temperature field</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sillbott</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">silltop</span><span class="p">):</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tintrusion</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tmoho</span> <span class="o">-</span> <span class="n">Tsurf</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span>

<span class="c1"># Plot initial temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tprev</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T initial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Start the loop over time steps</span>
<span class="n">curtime</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">curtime</span> <span class="o">&lt;</span> <span class="n">t_total</span><span class="p">:</span>
    <span class="n">curtime</span> <span class="o">=</span> <span class="n">curtime</span> <span class="o">+</span> <span class="n">dt</span>
    
    <span class="c1"># boundary conditions</span>
    <span class="n">Tnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tsurf</span>
    <span class="n">Tnew</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tmoho</span>
    
    <span class="c1"># internal grid points</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Tnew</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">Cp</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">vx</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">H</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">Cp</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">Tprev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        
    <span class="c1"># copy Tnew to Tprev</span>
    <span class="n">Tprev</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">Tnew</span><span class="p">[:]</span>

<span class="c1"># Plot the final temperature field</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tnew</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;T final&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>dx is 1206.896551724138 m
Calculating 1000 time steps
</pre></div>
</div>
<img alt="../_images/benchmarking_9_1.png" src="../_images/benchmarking_9_1.png" />
<img alt="../_images/benchmarking_9_2.png" src="../_images/benchmarking_9_2.png" />
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "IntroGM/2020",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "day-3"
        }
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By David Whipp and Lars Kaislaniemi<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-92357604-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>